<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Books — Michael C. Barros</title>
  <link rel="stylesheet" href="./style.css" />
  <!-- Load your data source (must exist at this path) -->
  <script defer src="./js/data/data.js"></script>
  <style>
    .shell{max-width:1060px;margin:0 auto;padding:20px 20px 48px}
    .site-header{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{font-weight:700;text-decoration:none;color:var(--ink)}
    .nav{display:flex;gap:18px;flex-wrap:wrap}
    .nav a{color:var(--ink);text-decoration:none}
    .nav a:hover{text-decoration:underline}
    .hero--compact{padding:18px 0 6px}
    .muted{color:var(--muted)}
    .book-hero{display:grid;gap:18px;align-items:center}
    @media(min-width:900px){.book-hero{grid-template-columns:180px 1fr}}
    .book-cover{width:100%;height:auto;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.08)}
    .cta-row{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.5rem}
    .btn{display:inline-block;padding:.7rem 1.1rem;border-radius:.7rem;background:var(--ink);color:#fff;text-decoration:none;font-weight:700}
    .btn:hover{filter:brightness(1.08)}
    .btn.ghost{background:transparent;color:var(--ink);border:2px solid var(--ink)}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}}
    .card{background:#fff;border:1px solid rgba(160,125,59,.25);border-radius:12px;padding:16px;transition:.2s}
    .card:hover{border-color:rgba(160,125,59,.5);box-shadow:0 10px 26px rgba(0,0,0,.08);transform:translateY(-2px)}
    .badge{display:inline-block;border:1px solid rgba(160,125,59,.35);color:var(--accent);font-family:'IBM Plex Mono',monospace;font-size:.72rem;padding:.15rem .45rem;border-radius:.4rem;margin-bottom:.35rem}
    .empty{padding:1rem;border:1px dashed #e5e7eb;border-radius:.75rem;background:#fafafa}
 .book-hero { align-items: start }
.book-hero h2 { font-size: clamp(1.8rem, 3.2vw, 2.4rem); letter-spacing:-.01em }
.review { background:#fff;border:1px solid rgba(160,125,59,.25);border-radius:10px;padding:12px }

  </style>
</head>
<body class="page">
  <div class="shell">
    <!-- Header -->
    <header class="site-header">
      <a class="brand" href="./index.html">Michael C. Barros</a>
      <nav class="nav" aria-label="Main">
        <a href="./about.html">About</a>
        <a href="./books.html" aria-current="page">Books</a>
        <a id="nav-blog" href="https://mythonoesis.substack.com/" target="_blank" rel="noopener">Blog</a>
        <a href="./projects.html">Projects</a>
        <a id="nav-research" href="#" target="_blank" rel="noopener">Research</a>
        <a href="./contact.html">Contact</a>
      </nav>
    </header>

    <section class="hero--compact">
      <h1>Books</h1>
      <p class="muted">Published and forthcoming work on religion and popular culture.</p>
    </section>

    <div class="divider"></div>

    <!-- Featured -->
    <section aria-labelledby="featured-heading">
      <div class="section-head">
        <h2 id="featured-heading">Featured</h2>
      </div>

      <div class="book-hero" id="book-hero">
        <!-- JS fills this. Fallback shows if no data. -->
        <img class="book-cover" src="./assets/images/books/pkd.jpg" alt="Book cover" loading="lazy">
        <div>
          <h3 style="margin:.2rem 0">Current Book</h3>
          <p class="muted">Add book details in <code>js/data/data.js</code>.</p>
          <div class="cta-row">
            <a class="btn" href="./books.html">All books</a>
            <a class="btn ghost" href="https://amzn.to/46Fn12N" target="_blank" rel="noopener">Buy on Amazon</a>
          </div>
        </div>
      </div>
    </section>

    <div class="divider"></div>

    <!-- More Books -->
    <section aria-labelledby="more-heading">
      <div class="section-head">
        <h2 id="more-heading">More Books</h2>
      </div>
      <div id="more-books" class="grid cols-3"></div>
      <div id="empty-msg" class="empty" style="display:none">No additional books yet.</div>
    </section>

    <footer class="footer">© <span id="year"></span> Michael C. Barros</footer>
  </div>

  <script>
    // Basic external links (optional)
    const LINKS = (window.SITE_DATA && window.SITE_DATA.links) || window.LINKS || {
      blog: "https://mythonoesis.substack.com/",
      research: "https://www.researchgate.net/",
    };
    document.getElementById('nav-blog').href = LINKS.blog;
    document.getElementById('nav-research').href = LINKS.research;
    document.getElementById('year').textContent = new Date().getFullYear();

    <script>
  function renderBooks(){
    const books = (window.SITE_DATA && Array.isArray(window.SITE_DATA.books) ? window.SITE_DATA.books : (window.BOOKS || []));
    const yearEl = document.getElementById('year'); if (yearEl) yearEl.textContent = new Date().getFullYear();
    if (!books.length){
      console.warn("No books found. Check js/data/data.js and SITE_DATA.books.");
      document.getElementById('empty-msg')?.style.setProperty('display','block');
      return;
    }

    const featured = books.find(b=>b.featured) || books[0];
    const hero = document.getElementById('book-hero');

    // Build text column first
    const text = document.createElement('div');
    text.innerHTML = `
      <h2 style="margin:.2rem 0 0.4rem;font-size:1.9rem">${featured.title}</h2>
      ${featured.description ? `<p class="muted" style="margin:0.4rem 0 0.6rem">${featured.description}</p>` : (featured.summary ? `<p class="muted">${featured.summary}</p>` : ``)}
      <div class="cta-row" style="justify-content:flex-start">
        <a class="btn" href="${featured.url || './books.html'}">All books</a>
        ${featured.buy_links?.length ? `<a class="btn ghost" href="${featured.buy_links[0].url}" target="_blank" rel="noopener">${featured.buy_links[0].label || 'Buy'}</a>` : ``}
      </div>
      ${featured.reviews?.length ? `
        <div class="review" style="margin-top:14px">
          <p style="margin:0 0 .4rem">“${featured.reviews[0].quote.replace(/(^"|"$)/g,'')}”</p>
          <small>— ${featured.reviews[0].source}</small>
        </div>` : ``}
    `;

    // Build image (with onload/onerror to avoid alt flash)
    const imgWrap = document.createElement('div');
    const img = new Image();
    img.className = 'book-cover';
    img.alt = `${featured.title} cover`;
    img.loading = 'lazy';
    img.src = featured.cover || './assets/images/books/placeholder.jpg';
    img.onerror = () => { img.src = './assets/images/books/placeholder.jpg'; };
    imgWrap.appendChild(img);

    // Lay out: cover left, text right (on large screens)
    hero.innerHTML = '';
    hero.appendChild(imgWrap);
    hero.appendChild(text);

    // Render the rest
    const rest = books.filter(b => b !== featured);
    const wrap = document.getElementById('more-books');
    wrap.innerHTML = '';
    if (!rest.length){
      document.getElementById('empty-msg')?.style.setProperty('display','block');
      return;
    }
    document.getElementById('empty-msg')?.style.setProperty('display','none');

    rest.forEach(b=>{
      const a = document.createElement('a');
      a.className = 'card';
      a.href = b.url || '#';
      if (b.external) { a.target = "_blank"; a.rel = "noopener"; }
      a.innerHTML = `
        <span class="badge">${b.status || 'Book'}</span>
        <h3>${b.title}</h3>
        <p class="muted">${b.description || b.summary || ''}</p>
      `;
      wrap.appendChild(a);
    });
  }

  window.addEventListener('DOMContentLoaded', ()=> setTimeout(renderBooks, 30));
</script>
